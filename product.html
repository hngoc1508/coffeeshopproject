<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết sản phẩm - Coffee House</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <header>
        <div class="container navbar">
            <a href="index.html" class="logo"><i class="fas fa-coffee"></i> COFFEE HOUSE</a>
            <nav class="nav-links">
                <a href="index.html">Thực đơn</a>
                <a href="news.html">Tin tức</a>
                <a href="about.html">Về chúng tôi</a>
                <a href="contact.html">Liên hệ</a>
            </nav>
            <a href="card.html" class="cart-icon">
                <i class="fas fa-shopping-bag"></i>
                <span class="cart-badge" id="cart-count">0</span>
            </a>
            <div class="account-area" style="margin-left:12px;"></div>
        </div>
    </header>

    <div class="container" style="margin-top: 40px; max-width: 1000px;">
        <div id="product-detail" style="display:grid; grid-template-columns: 360px 1fr; gap:30px; align-items:start;"></div>
    </div>

    <script src="assets/js/app.js"></script>
    <script>
        // Read product id from query string and render
        const params = new URLSearchParams(location.search);
        const id = parseInt(params.get('id')) || null;
        function renderProductDetail(id) {
            const product = products.find(p => p.id === id);
            const el = document.getElementById('product-detail');
            if (!product || !el) return el.innerHTML = '<p>Sản phẩm không tìm thấy.</p>';

            el.innerHTML = `
                <div class="card-img" style="height:360px; border-radius:12px; overflow:hidden;"><img src="${product.img}" style="width:100%; height:100%; object-fit:cover;"></div>
                <div>
                    <h2>${product.name}</h2>
                    <p style="color:#666;">${product.description || ''}</p>
                    <h3 style="color:var(--primary-color); margin-top:8px;">${product.price.toLocaleString()} đ</h3>

                    <div style="margin-top:18px; display:flex; flex-direction:column; gap:12px;">
                        ${product.options.sugar && product.options.sugar.length ? `
                            <div>
                                <div style="font-weight:600; margin-bottom:6px;">Đường</div>
                                ${product.options.sugar.map(s => `<label style="margin-right:8px;"><input type="radio" name="sugar" value="${s}" ${s===product.options.sugar[0] ? 'checked' : ''}> ${s}%</label>`).join('')}
                            </div>
                        ` : ''}

                        ${product.options.ice && product.options.ice.length ? `
                            <div>
                                <div style="font-weight:600; margin-bottom:6px;">Đá</div>
                                ${product.options.ice.map((i, idx) => `<label style="margin-right:8px;"><input type="radio" name="ice" value="${i}" ${idx===0 ? 'checked' : ''}> ${i}</label>`).join('')}
                            </div>
                        ` : ''}

                        ${product.options.toppings && product.options.toppings.length ? `
                            <div>
                                <div style="font-weight:600; margin-bottom:6px;">Topping</div>
                                ${product.options.toppings.map(t => `<label style="display:inline-flex; align-items:center; gap:6px; margin-right:8px;"><input type="checkbox" name="topping" value="${t.id}" data-price="${t.price}"> ${t.name} (+${t.price.toLocaleString()} đ)</label>`).join('')}
                            </div>
                        ` : ''}

                        <div style="display:flex; gap:12px; align-items:center; margin-top:6px;">
                            <label style="font-weight:600;">Số lượng:</label>
                            <input id="qty" type="number" value="1" min="1" style="width:70px; padding:8px; border-radius:6px; border:1px solid #eee;">
                        </div>

                        <div style="display:flex; gap:12px; margin-top:12px;">
                            <button class="btn-cta" id="add-with-options">Thêm vào giỏ</button>
                            <a href="index.html" class="btn" style="align-self:center; padding:10px 14px; border-radius:8px;">Quay lại</a>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('add-with-options').addEventListener('click', () => {
                const sugarEl = document.querySelector('input[name="sugar"]:checked');
                const iceEl = document.querySelector('input[name="ice"]:checked');
                const toppingEls = Array.from(document.querySelectorAll('input[name="topping"]:checked'));
                const qty = parseInt(document.getElementById('qty').value) || 1;
                const options = {
                    sugar: sugarEl ? sugarEl.value : null,
                    ice: iceEl ? iceEl.value : null,
                    toppings: toppingEls.map(t => ({ id: t.value, price: parseInt(t.dataset.price), name: t.parentElement.innerText.trim().split('+')[0].trim() }))
                };
                addToCart(product.id, qty, options);
                alert('Đã thêm ' + product.name + ' với lựa chọn của bạn.');
                updateCartCount();
            });
        }

        if (id) renderProductDetail(id);
    </script>
</body>
</html>
